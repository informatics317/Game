# –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
from Save_and_registration import*
# –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–≤–æ–π –≤–µ—Ç–∫–æ–π
from First_branch import *
# –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ —Å–æ –≤—Ç–æ—Ä–æ–π –≤–µ—Ç–∫–æ–π
from Second_branch import *
# –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ —Å —Ç—Ä–µ—Ç—å–µ–π –≤–µ—Ç–∫–æ–π
from Battle import*

'''–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'''
def show_menu():
    print('\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:')
    print('1. üÜï –ù–æ–≤–∞—è –∏–≥—Ä–∞')
    print('2. ‚Ü©Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É')
    print('3. üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è')
    print('4. üîö –í—ã—Ö–æ–¥')

'''–°—Ç–∞—Ç—É—Å –∏–≥—Ä–æ–∫–∞'''
def show_status(arthur, artifacts):
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    log_event('\n' + '=' * 40)
    log_event(' ' * 10 + '–í–∞—à–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ')
    log_event('=' * 40)
    log_event(f'‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {arthur.hp}/100')
    log_event(f'üí™ –°–∏–ª–∞: {arthur.strength}')
    log_event(f'üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: {arthur.iq}')
    log_event(f'üó°Ô∏è –≠–∫—Å–∫–∞–ª–∏–±—É—Ä: {'–ï–°–¢–¨ ‚úÖ' if arthur.excalibur else '–ù–ï–¢ ‚ùå'}')
    log_event(f'üèÜ –°–≤—è—â–µ–Ω–Ω—ã–π –ì—Ä–∞–∞–ª—å: {'–ï–°–¢–¨ ‚úÖ' if arthur.graal == True else '–ù–ï–¢ ‚ùå'}')
    log_event(f'üß™ –≠–ª–∏–∫—Å–∏—Ä–æ–≤ –∑–¥–æ—Ä–æ–≤—å—è: {arthur.health_elixir}')

    if artifacts:
        log_event(f'üéí –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: {', '.join(artifacts)}')
    else:
        log_event('üéí –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –Ω–µ—Ç')
    print('=' * 40)

'''–í–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å —Å —Ä–∞–∑–≤–∏–ª–∫–æ–π'''
def magic_forest(arthur, user_artifacts, artifact_pool, story_progress):
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    log_event('\n–¢—ã –≤—Ö–æ–¥–∏—à—å –≤ –í–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å. –í–æ–∫—Ä—É–≥ —Å–ª—ã—à–Ω–æ –ø–µ–Ω–∏–µ –ø—Ç–∏—Ü.')
    log_event('–¢—ã –¥–æ—Ö–æ–¥–∏—à—å –¥–æ —Ä–∞–∑–≤–∏–ª–∫–∏.')
    while True:
        print('\n' + '=' * 50)
        print(' ' * 10 + '–†–∞–∑–≤–∏–ª–∫–∞ –≤ –í–æ–ª—à–µ–±–Ω–æ–º –ª–µ—Å—É')
        print('=' * 50)
        print('\n–¢—ã –Ω–∞ —Ä–∞–∑–≤–∏–ª–∫–µ. –ö—É–¥–∞ –ø–æ–π–¥–µ—à—å?')
        # –ò–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é
        print('1. ‚û°Ô∏è –ù–∞–ø—Ä–∞–≤–æ')
        print('2. ‚¨ÖÔ∏è –ù–∞–ª–µ–≤–æ')

        # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –±–∏—Ç–≤—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ–π–¥–µ–Ω–∞ —Ö–æ—Ç—å –æ–¥–Ω–∞ –≤–µ—Ç–∫–∞
        if story_progress:
            print('3. üëø –°—Ä–∞–∑–∏—Ç—å—Å—è —Å –ú–æ—Ä–¥—Ä–µ–¥–æ–º')

        print('4. üìä –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–π —Å—Ç–∞—Ç—É—Å')
        print('5. üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É')
        print('6. üö™ –í—ã–π—Ç–∏ –≤ –º–µ–Ω—é')

        try:
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
            choice = int(input('\n–¢–≤–æ–π –≤—ã–±–æ—Ä: '))
        except:
            print('‚ùå –í–≤–µ–¥–∏ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 6!')
            continue

        # –ù–∞–ø—Ä–∞–≤–æ (–∫ —Å—Ç–∞—Ä—Ü—É)
        if choice == 1:
            way = first_branch(arthur, user_artifacts, artifact_pool, story_progress)

        # –ù–∞–ª–µ–≤–æ (–≤ –ø–µ—â–µ—Ä—É –∫ –≥–Ω–æ–º—É)
        elif choice == 2:
            way = second_branch(arthur, user_artifacts, artifact_pool, story_progress)


        elif choice == 3 and story_progress: # –ë–∏—Ç–≤–∞ —Å –ú–æ—Ä–¥—Ä–µ–¥–æ–º (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã 1 –ø—Ä–æ–π–¥–µ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞)
            if 'battle' in story_progress:
                print('\nüëø –¢—ã —É–∂–µ –ø–æ–±–µ–¥–∏–ª –ú–æ—Ä–¥—Ä–µ–¥–∞!')
            else:
                way = battle(arthur, user_artifacts)
                # –ï—Å–ª–∏ –ø–æ–±–µ–¥–∏–ª–∏
                if way:
                    story_progress.append('battle')
                    # –ü–æ—Å–ª–µ –ø–æ–±–µ–¥—ã –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –¥–∞–ª—å—à–µ –∏–ª–∏ –≤—ã–π—Ç–∏
                    print('\n–•–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ª–µ—Å?')
                    print('1. –î–∞, —Ö–æ—á—É –Ω–∞–π—Ç–∏ –µ—â–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤!')
                    print('2. –ù–µ—Ç, –∑–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É')

                    try:
                        # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
                        num = int(input('–¢–≤–æ–π –≤—ã–±–æ—Ä: '))
                        if num == 2:
                            # –ó–∞–≤–µ—Ä—à–∞–µ–º –∏–≥—Ä—É
                            return True
                    except:
                        pass
        # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        elif choice == 4:
            show_status(arthur, user_artifacts)

        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        elif choice == 5:
            load_game()
            save_game(arthur, story_progress, user_artifacts)

        # –í—ã–π—Ç–∏ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        elif choice == 6:
            return True
        else:
            print('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä!')

        # –ï—Å–ª–∏ –ê—Ä—Ç—É—Ä –º–µ—Ä—Ç–≤
        if not arthur.is_alive:
            log_event('\nüíÄ –£ —Ç–µ–±—è –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –∑–¥–æ—Ä–æ–≤—å–µ!')
            log_event('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞...')
            # –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∏–≥—Ä—É
            return False

    return True

'''–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–≥—Ä—ã'''
def main(user_artifacts, artifact_pool):
    print('\n' + '=' * 50)
    print(' ' * 9 + 'ü§¥üèª –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∫–æ—Ä–æ–ª—è –ê—Ä—Ç—É—Ä–∞ ‚öîÔ∏è')
    print('=' * 50)

    # –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª –¥–ª—è –ª–æ–≥–æ–≤ (—Ö–æ–¥ –∏–≥—Ä—ã)
    # –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª result.txt –≤ —Ä–µ–∂–∏–º–µ –∑–∞–ø–∏—Å–∏ 'w'
    with open(result_file, 'w', encoding='utf-8') as f:
        f.write('=' * 50 + '\n')
        f.write('ü§¥üèª –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∫–æ—Ä–æ–ª—è –ê—Ä—Ç—É—Ä–∞ ‚öîÔ∏è\n')
        f.write('=' * 50 + '\n')


    while True:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        show_menu()

        try:
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
            choice = int(input('\n–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ (1-4): '))
        except:
            print('‚ùå –í–≤–µ–¥–∏ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 4!')
            continue

        # –ù–æ–≤–∞—è –∏–≥—Ä–∞
        if choice == 1:
            # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            username = log_in_game()
            if not username:
                continue

            # –°–æ–∑–¥–∞–µ–º –ê—Ä—Ç—É—Ä–∞
            arthur = Hero('–ê—Ä—Ç—É—Ä', strength = 25, iq = 15, damage = 30, hp = 100)
            # –°–æ–∑–¥–∞–µ—Ç –∫–æ–ø–∏–ª–∫—É –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
            create_artifact_pool()

            # –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–ø–∏–ª–∫—É –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
            artifact_pool = load_artifact_pool()
            # –ò–≥—Ä–æ–∫ –≤—ã–±–∏—Ä–∞–µ—Ç 3 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
            user_artifacts = choose_artifacts()

            # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö –≤–µ—Ç–æ–∫
            story_progress = []

            print('\n' + '=' * 50)
            print(' ' * 10 + '–ù–∞—á–∞–ª–æ –∏–≥—Ä—ã')
            print('=' * 50)
            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
            log_event('\n–õ–µ–≥–µ–Ω–¥–∞:')
            log_event('üìú –¢—ã - –∫–æ—Ä–æ–ª—å –ê—Ä—Ç—É—Ä. –ù–∞–¥ –ö–∞–º–µ–ª–æ—Ç–æ–º –Ω–∞–≤–∏—Å–ª–∞ –æ–ø–∞—Å–Ω–æ—Å—Ç—å.')
            log_event('–ü—Ä–µ–¥–∞—Ç–µ–ª—å –ú–æ—Ä–¥—Ä–µ–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –∑–∞–º–æ–∫.')
            log_event('–ò —Ç–æ–ª—å–∫–æ —Ç—ã –º–æ–∂–µ—à—å –ø–æ–º–µ—à–∞—Ç—å –µ–º—É.')
            log_event('–î–ª—è —ç—Ç–æ–≥–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –º–µ—á –≠–∫—Å–∫–∞–ª–∏–±—É—Ä –∏ –°–≤—è—Ç–æ–π –ì—Ä–∞–∞–ª—å.')
            log_event('–û–Ω–∏ –∑–∞—Ç–µ—Ä—è–Ω—ã –≥–¥–µ-—Ç–æ –≤ –í–æ–ª—à–µ–±–Ω–æ–º –ª–µ—Å—É.')
            log_event('–ù–µ —Ç–µ—Ä—è–π –∂–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Å—è –≤ –ø—É—Ç—å. üìú')

            # –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É (–≤ –í–æ–ª—à–µ–±–Ω–æ–º –ª–µ—Å—É)
            way = magic_forest(arthur, user_artifacts, artifact_pool, story_progress)

            if not way:
                print('\nüíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞')
                input('–ù–∞–∂–º–∏ Enter —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é...')

        # –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É
        elif choice == 2:
            # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            username = log_in_game()
            if not username:
                continue

            # –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            arthur_specific, user_artifacts, story_progress, artifact_pool = load_game()

            if arthur_specific is None:
                print('‚ùå –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã!')
                continue

            else:

                # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ê—Ä—Ç—É—Ä–∞ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                arthur = Artur
                arthur.hp = arthur_specific['hp']
                arthur.strength = arthur_specific['strength']
                arthur.iq = arthur_specific['iq']
                arthur.excalibur = arthur_specific['excalibur']
                arthur.health_elixir = arthur_specific['health_elixir']


            print('\n‚úÖ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!')
            print(f'–ü—Ä–æ–≥—Ä–µ—Å—Å: {len(story_progress)} –≤–µ—Ç–æ–∫ –ø—Ä–æ–π–¥–µ–Ω–æ')

            # –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä—É
            way = magic_forest(arthur, user_artifacts, artifact_pool, story_progress)

            if not way:
                print('\nüíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞')
                input('–ù–∞–∂–º–∏ Enter —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é...')

        # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        elif choice == 3:
            username = registrations_user()
            if username:
                print(f'\n‚úÖ –¢—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ {username}')
                print('–¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏ –≤ –∏–≥—Ä—É!')
                input('–ù–∞–∂–º–∏ Enter —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å...')

        # –í—ã—Ö–æ–¥ –∏–∑ –∏–≥—Ä—ã
        elif choice == 4:
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ –∫–æ–ø–∏–ª–∫—É
            return_artifacts_to_pool(user_artifacts, artifact_pool)
            print('\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!')
            # –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
            break

        else:
            print('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä!')


if __name__ == '__main__':
    # –í—ã–∑–æ–≤ –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    main('user_artifacts.txt', 'artifact_pool.txt')