# –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ —Å –±–æ—Å—Å–æ–º
from Boss import*
# –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏
from Artifacts import*

'''–í–µ—Ç–∫–∞ 3 –ì–ª–∞–≤–Ω–∞—è –±–∏—Ç–≤–∞'''
def battle(arthur, user_artifacts):
    log_event('\n' + '=' * 50)
    log_event(' ' * 10 + '–ë–∏—Ç–≤–∞ —Å –ú–æ—Ä–¥—Ä–µ–¥–æ–º')
    log_event('=' * 50)

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    log_event('–¢—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—à—å—Å—è –∏–∑ –í–æ–ª—à–µ–±–Ω–æ–≥–æ –ª–µ—Å–∞.')
    log_event('\nüëø –ú–æ—Ä–¥—Ä–µ–¥ —É–∂–µ —É –≤–æ—Ä–æ—Ç –∑–∞–º–∫–∞ –ö–∞–º–µ–ª–æ—Ç.')
    log_event('–í–æ—Ç –∏ –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è —Å—Ä–∞–∑–∏—Ç—å—Å—è!')
    log_event('üßôüèª‚Äç‚ôÇÔ∏è –ö —Ç–µ–±–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –ú–µ—Ä–ª–∏–Ω.')
    log_event('üßù –ö —Ç–µ–±–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –õ–∞–Ω—Å–µ–ª–æ—Ç.')

    # –°—á–µ—Ç—á–∏–∫ —Ä–∞—É–Ω–¥–æ–≤
    round_num = 1

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    log_event(f'\n‚ù§Ô∏è –¢–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ: {arthur.hp}')
    log_event(f'üßô‚Äç‚ôÇÔ∏è –ó–¥–æ—Ä–æ–≤—å–µ –ú–µ—Ä–ª–∏–Ω–∞: {Merlin.hp}')
    log_event(f'üßù –ó–¥–æ—Ä–æ–≤—å–µ –õ–∞–Ω—Å–µ–ª–æ—Ç–∞: {Lancelot.hp}')
    log_event(f'üëø –ó–¥–æ—Ä–æ–≤—å–µ –ú–æ—Ä–¥—Ä–µ–¥–∞: {Mordred.hp}')

    # –ü–æ–∫–∞ –∂–∏–≤ –ê—Ä—Ç—É—Ä –∏ –∂–∏–≤ –ú–æ—Ä–¥—Ä–µ–¥
    while arthur.is_alive and Mordred.is_alive:
        log_event('=' * 30)
        log_event(f'{' ' * 10} –†–∞—É–Ω–¥ {round_num}')
        log_event('=' * 30)

        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
        log_event(f'\n‚ù§Ô∏è –ê—Ä—Ç—É—Ä: {arthur.hp}')
        log_event(f'üßôüèª‚Äç‚ôÇÔ∏è –ú–µ—Ä–ª–∏–Ω: {Merlin.hp}')
        log_event(f'üßù –õ–∞–Ω—Å–µ–ª–æ—Ç: {Lancelot.hp}')
        log_event(f'üëø –ú–æ—Ä–¥—Ä–µ–¥: {Mordred.hp}')

        # –•–æ–¥ –∏–≥—Ä–æ–∫–∞
        # –ï—Å–ª–∏ –ê—Ä—Ç—É—Ä –∂–∏–≤
        if arthur.is_alive:
            print('\n–¢–≤–æ–π —Ö–æ–¥:')
            # –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            print('1. ‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å')
            # –ï—Å–ª–∏ —É –ê—Ä—Ç—É—Ä–∞ –µ—Å—Ç—å –≠–∫—Å–∫–∞–ª–∏–±—É—Ä, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∞—Ç–∞–∫–∏ –∏–º
            print('2. üó°Ô∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å –≠–∫—Å–∫–∞–ª–∏–±—É—Ä–æ–º' if arthur.excalibur else '')
            # –ï—Å–ª–∏ —É –ê—Ä—Ç—É—Ä–∞ –µ—Å—Ç—å –≠–ª–∏–∫—Å–∏—Ä—ã –∑–¥–æ—Ä–æ–≤—å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            print('3. üß™ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≠–ª–∏–∫—Å–∏—Ä –∑–¥–æ—Ä–æ–≤—å—è' if arthur.health_elixir > 0 else '')

            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –∏–≥—Ä–æ–∫–∞ –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è
            choice = int(input('–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ: '))

            if choice == 1:     # –ü—Ä–æ—Å—Ç–∞—è –∞—Ç–∞–∫–∞
                damage = arthur.attack(Mordred)
            elif choice == 2 and arthur.excalibur:     # –ê—Ç–∞–∫–∞ –≠–∫—Å–∫–∞–ª–∏–±—É—Ä–æ–º
                damage = arthur.attack_excalibur(Mordred)
            elif choice == 3 and arthur.health_elixir > 0:  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–ª–∏–∫—Å–∏—Ä–∞
                arthur.use_health_elixir()
            else:
                log_event('‚ùå –¢—ã –ø—Ä–æ–ø—É—Å–∫–∞–µ—à—å —Ö–æ–¥!')

        # –•–æ–¥ –ú–µ—Ä–ª–∏–Ω–∞
        # –ï—Å–ª–∏ –ú–µ—Ä–ª–∏–Ω –∂–∏–≤
        if Merlin.is_alive:
            # –ï—Å–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ –ê—Ä—Ç—É—Ä–∞ –∏–ª–∏ –õ–∞–Ω—Å–µ–ª–æ—Ç–∞ –º–µ–Ω—å—à–µ 50 - –ª–µ—á–∏—Ç
            if  arthur.hp < 50 or Lancelot.hp < 50:
                # –õ–µ—á–∏—Ç —Ç–æ–≥–æ, —É –∫–æ–≥–æ –º–µ–Ω—å—à–µ –∑–¥–æ—Ä–æ–≤—å—è
                if arthur.hp < Lancelot.hp:
                    Merlin.heal(arthur)
                else:
                    Merlin.heal(Lancelot)
            else:
                # –ï—Å–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ –≤ –ø–æ—Ä—è–¥–∫–µ - –∞—Ç–∞–∫—É–µ—Ç –æ–≥–Ω–µ–º
                Merlin.attack_fire(Mordred)

        # –•–æ–¥ –õ–∞–Ω—Å–µ–ª–æ—Ç–∞
        # –ï—Å–ª–∏ –õ–∞–Ω—Å–µ–ª–æ—Ç –∂–∏–≤
        if Lancelot.is_alive:
            # –õ–∞–Ω—Å–µ–ª–æ—Ç –∞—Ç–∞–∫—É–µ—Ç –∫–æ–ø—å–µ–º
            Lancelot.attack_spear(Mordred)

        # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∂–∏–≤ –ª–∏ –ú–æ—Ä–¥—Ä–µ–¥
        if not Mordred.is_alive:
            # –ï—Å–ª–∏ –ú–æ—Ä–¥—Ä–µ–¥ –º–µ—Ä—Ç–≤ - –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
            break

        # –•–æ–¥ –ú–æ—Ä–¥—Ä–µ–¥–∞
        # –°–ø–∏—Å–æ–∫ –∂–∏–≤—ã—Ö —Å–æ—é–∑–Ω–∏–∫–æ–≤
        alive_allies = []
        # –ï—Å–ª–∏ –ê—Ä—Ç—É—Ä –∂–∏–≤, –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–ø–∏—Å–æ–∫
        if arthur.is_alive:
            alive_allies.append(arthur)
        # –ï—Å–ª–∏ –ú–µ—Ä–ª–∏–Ω –∂–∏–≤, –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–ø–∏—Å–æ–∫
        if Merlin.is_alive:
            alive_allies.append(Merlin)
        # –ï—Å–ª–∏ –õ–∞–Ω—Å–µ–ª–æ—Ç –∂–∏–≤, –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–ø–∏—Å–æ–∫
        if Lancelot.is_alive:
            alive_allies.append(Lancelot)

        # –ï—Å–ª–∏ –µ—Å—Ç—å –∂–∏–≤—ã–µ —Å–æ—é–∑–Ω–∏–∫–∏, –ú–æ—Ä–¥—Ä–µ–¥ –∞—Ç–∞–∫—É–µ—Ç
        if alive_allies:
            # –°–Ω–∞—á–∞–ª–∞ –ú–æ—Ä–¥—Ä–µ–¥ –∞—Ç–∞–∫—É–µ—Ç –≤—Å–µ—Ö
            Mordred.attack_everyone(arthur, Merlin, Lancelot)
            # –ü–æ—Ç–æ–º –µ–≥–æ —Ä–∞–Ω–¥–æ–º–Ω–∞—è –∞—Ç–∞–∫–∞
            boss_attack()

        # –°—á–µ—Ç—á–∏–∫ —Ä–∞—É–Ω–¥–æ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
        round_num += 1

        # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∂–∏–≤—ã–µ —Å–æ—é–∑–Ω–∏–∫–∏
        # any() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ —Å–æ—é–∑–Ω–∏–∫–æ–≤ –∂–∏–≤
        if not any([arthur.is_alive, Merlin.is_alive, Lancelot.is_alive]):
            log_event('\nüíÄ –í—Å–µ –≥–µ—Ä–æ–∏ –ø–æ–≥–∏–±–ª–∏ –≤ –±–æ—é!')
            return False

    # –†–µ–∑—É–ª—å—Ç–∞—Ç –±–∏—Ç–≤—ã
    # –ï—Å–ª–∏ –ú–æ—Ä–¥—Ä–µ–¥ –≤—ã–∂–∏–ª
    if Mordred.is_alive:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
        log_event("\nüíÄ –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª! –ú–æ—Ä–¥—Ä–µ–¥ –∑–∞—Ö–≤–∞—Ç–∏–ª –∑–∞–º–æ–∫...")
        return False    # –ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª
    # –ï—Å–ª–∏ –ú–æ—Ä–¥—Ä–µ–¥ –º–µ—Ä—Ç–≤
    else:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
        log_event('\n' + '=' * 50)
        log_event(' ' * 20 + 'üèÜ –ü–û–ë–ï–î–ê!')
        log_event('=' * 50)
        log_event('üëø –ú–æ—Ä–¥—Ä–µ–¥ –ø–æ–±–µ–∂–¥–µ–Ω!')
        log_event('üéâ –¢—ã —Å–ø–∞—Å –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ!')

        # –ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É
        user_artifacts.append('üëë –ö–æ—Ä–æ–Ω–∞ –ü–æ–±–µ–¥–∏—Ç–µ–ª—è')
        # –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –≤ —Ñ–∞–π–ª –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏–≥—Ä–æ–∫–∞
        with open(user_artifacts_file, 'a', encoding='utf-8') as f:
            f.write(f'\nüëë –ö–æ—Ä–æ–Ω–∞ –ü–æ–±–µ–¥–∏—Ç–µ–ª—è')
        log_event('üéÅ –¢—ã –ø–æ–ª—É—á–∞–µ—à—å –ö–æ—Ä–æ–Ω—É –ü–æ–±–µ–¥–∏—Ç–µ–ª—è!')

        return True   # –ò–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª
